@inject IDiaryService diaryService;

<MudStack>
    @foreach(var section in Sections)
    {
        <MudTextField
            @bind-Value="section.Title"
            Label="Title"
            DebounceInterval="debounceTimeMilleseconds"
            OnDebounceIntervalElapsed="() => diaryService.UpsertSection(Date, section, false)"
            Lines="1"
        />
        <MudTextField
            @bind-Value="section.Body"
            Label="Body"
            DebounceInterval="debounceTimeMilleseconds"
            OnDebounceIntervalElapsed="() => diaryService.UpsertSection(Date, section, false)"
            Lines="5"
        />
    }
</MudStack>
<MudButton Variant="Variant.Filled" @onclick="AddSection" EndIcon="@Icons.Material.Filled.Add" Color="Color.Primary">Add Section</MudButton>

@code {
    [Parameter]
    public DateOnly Date { get; set; }
    [Parameter]
    public List<DiarySection> Sections { get; set; }

    private const int debounceTimeMilleseconds = 2000;

    private void AddSection()
    {
        int sectionId = 1;
        if (Sections.Any())
        {
            sectionId = Sections.Max(x => x.SectionId) + 1;
        }
        Sections.Add(new DiarySection(sectionId));
    }
}
